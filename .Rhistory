# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
simz2 %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz2 %<>% bind_cols(parnames)
simz2 %<>% gather(key, value, -PC, -pct, -hr_y)
simz2$PC <- factor(simz2$PC, levels=c('1','6','11'))
simz2$pct <- factor(simz2$pct, levels=c('1','0.1','0.01','0.001'))
simz2$hr_y <- factor(simz2$hr_y, levels=c('0.8','0.5','0.2'))
save(simz2, file = "result_z2.RData")
###########################################################################################
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpsnpz1_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz1_snp <- tmp %>% t
simz1_snp %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
simz1_snp %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz1_snp %<>% bind_cols(parnames)
simz1_snp %<>% gather(key, value, -PC, -pct, -hr_y)
simz1_snp$PC <- factor(simz1_snp$PC, levels=c('1','6','11'))
simz1_snp$pct <- factor(simz1_snp$pct, levels=c('1','0.1','0.01','0.001'))
simz1_snp$hr_y <- factor(simz1_snp$hr_y, levels=c('0.8','0.5','0.2'))
save(simz1_snp, file = "result_snpz1.RData")
########################
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpsnpz2_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz2_snp <- tmp %>% t
simz2_snp %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
simz2_snp %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz2_snp %<>% bind_cols(parnames)
simz2_snp %<>% gather(key, value, -PC, -pct, -hr_y)
simz2_snp$PC <- factor(simz2_snp$PC, levels=c('1','6','11'))
simz2_snp$pct <- factor(simz2_snp$pct, levels=c('1','0.1','0.01','0.001'))
simz2_snp$hr_y <- factor(simz2_snp$hr_y, levels=c('0.8','0.5','0.2'))
save(simz2_snp, file = "result_snpz2.RData")
knitr::opts_chunk$set(echo = TRUE, fig.width = 16, fig.height = 12)
library(ggplot2)
library(tidyverse)
library(gridExtra)
library(tidyr)
library(scales)
library(magrittr)
library(latex2exp)
load('result_z1.RData')
load('result_z2.RData')
load('result_snpz1.RData')
load('result_snpz2.RData')
# levels(esti$noi) <- c("low", "high")
# data_summary <- function(x){
#   m <- mean(x)
#   sd <-sd(x)
#   ymin<-m-1.96*sd
#   ymax<-m+1.96*sd
#   return(c(y=m,ymin=ymin,ymax=ymax))
# }
# New facet label names
PC.labs <- c("PC1-5", "PC6-10", "PC11-15")
names(PC.labs) <- c("1", "6","11")
# pct.labs <- c("0.1", "0.01", "0.001")
# names(pct.labs) <- c("0.1", "0.01", "0.001")
# plot function
tm_plot <- function(dat, title, ylim=c(NA,NA)){
ggplot(data = dat, aes(x = key, y = value, color = key))+
geom_boxplot(size =1.5)+
ggtitle(title)+
scale_y_continuous(limits=ylim)+
theme_bw()+
theme(axis.text=element_text(size=15),
title =element_text(size=15, face='bold'),
strip.text = element_text(size = 20),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
legend.text = element_text(size=15, face='bold'),
legend.position = "bottom") +
facet_grid(PC~pct, labeller = labeller(PC = PC.labs)
)
}
g_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)}
# esti$key %<>% factor(levels = c("a","b","B","ww","wwo","cc","cco","w_25","X_beta_25","c_25","Y_beta_25","R2TT","R2UU","RMSE","RMSE_x","RMSE_y","RMSE_train","RMSE_x_train","RMSE_y_train","R2","R2_x","R2_y","z_fit","sig2E","sig2F","sig2G","SigH","SigT","SigTo","SigUo","seedID"))
#
# levels(esti$key) <- c("a","b","B","W","Wo","C","Co","w_25","X_25","c_25","Y_25","R2TT","R2UU","RMSE","RMSE_x","RMSE_y","RMSE_train","RMSE_x_train","RMSE_y_train","R2","R2_x","R2_y","z_fit","sig2E","sig2F","sig2G","SigH","SigT","SigTo","SigUo","seedID")
# ab$key %<>% factor(levels = c("a", "a_b", "b"))
# levels(topss$method) <- c("O2PLS", "SO2PLS", "GO2PLS")
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 of Z in test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','O2PLS_snp','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_t', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 of Z in test")
mylegend<-g_legend(p1)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key))
1440/7
simz1 %>% filter(grepl('R2_o2_t', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key))
simz1 %>% filter(grepl('R2_o2_t', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key)) %>% filter(pct==0.001)
simz1_snp %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key))
simz1_snp %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.8') %>% filter(grepl('_t', key))
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpz1_"))
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpz2_"))
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpsnpz1_"))
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpsnpz1_"))
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpsnpz1_"))
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpz1_"))
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_diff', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 difference in training and test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','O2PLS_snp','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_diff', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 difference in training and test")
mylegend<-g_legend(p1)
cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene.pdf", width = 11, height =11, onefile =F, fallback_resolution = 600)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
dev.off()
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 of Z in test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','O2PLS_snp','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_t', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 of Z in test")
mylegend<-g_legend(p1)
cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene.pdf", width = 11, height =11, onefile =F, fallback_resolution = 600)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
dev.off()
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_diff', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 difference in training and test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','O2PLS_snp','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_diff', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 difference in training and test")
mylegend<-g_legend(p1)
# cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene.pdf", width = 11, height =11, onefile =F, fallback_resolution = 600)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
# dev.off()
simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_diff', key))
simz1 %>% filter(grepl('R2', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_diff', key))
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 of Z in test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_t', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 of Z in test")
mylegend<-g_legend(p1)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 of Z in test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_t', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 of Z in test")
mylegend<-g_legend(p1)
cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene.pdf", width = 11, height =11, onefile =F, fallback_resolution = 600)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
dev.off()
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_diff', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 difference in training and test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','O2PLS_snp','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_diff', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 difference in training and test")
mylegend<-g_legend(p1)
cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene_diff.pdf", width = 11, height =11, onefile =F, fallback_resolution = 600)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
dev.off()
p1
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_diff', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 difference in training and test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','O2PLS_snp','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
# p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_diff', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 difference in training and test")
# mylegend<-g_legend(p1)
cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene_diff.pdf", width = 6, height =11, onefile =F, fallback_resolution = 600)
p1
# gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
#                                     p2 + theme(legend.position="none"),
#                                     nrow=1),
#                         mylegend,nrow=2, heights=c(10,1))
dev.off()
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_diff', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 difference in training and test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','O2PLS_snp','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
# p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_diff', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 difference in training and test")
# mylegend<-g_legend(p1)
cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene_diff.pdf", width = 6, height =11, onefile =F, fallback_resolution = 600)
p1
# gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
#                                     p2 + theme(legend.position="none"),
#                                     nrow=1),
#                         mylegend,nrow=2, heights=c(10,1))
dev.off()
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_diff', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 difference in training and test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','O2PLS_snp','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
# p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_diff', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 difference in training and test")
# mylegend<-g_legend(p1)
cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene_diff.pdf", width = 9, height =9, onefile =F, fallback_resolution = 600)
p1
# gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
#                                     p2 + theme(legend.position="none"),
#                                     nrow=1),
#                         mylegend,nrow=2, heights=c(10,1))
dev.off()
setwd("~/Mygit/Scripts/PRS-simu_new/results")
setwd("~/Mygit/Scripts/PRS-simu_new/results")
library(tidyverse)
library(magrittr)
library(reshape2)
library(parallel)
#########################################################################################
#### params
###########################################################################################
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpz1_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz1 <- tmp %>% t
simz1 %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
# add diff
simz1 %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz1 %<>% bind_cols(parnames)
simz1 %<>% gather(key, value, -PC, -pct, -hr_y)
simz1$PC <- factor(simz1$PC, levels=c('1','6','11'))
simz1$pct <- factor(simz1$pct, levels=c('1','0.1','0.01','0.001'))
simz1$hr_y <- factor(simz1$hr_y, levels=c('0.8','0.5','0.2'))
save(simz1, file = "result_z1.RData")
###############
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpz2_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz2 <- tmp %>% t
simz2 %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
simz2 %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz2 %<>% bind_cols(parnames)
simz2 %<>% gather(key, value, -PC, -pct, -hr_y)
simz2$PC <- factor(simz2$PC, levels=c('1','6','11'))
simz2$pct <- factor(simz2$pct, levels=c('1','0.1','0.01','0.001'))
simz2$hr_y <- factor(simz2$hr_y, levels=c('0.8','0.5','0.2'))
save(simz2, file = "result_z2.RData")
###########################################################################################
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpsnpz1_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz1_snp <- tmp %>% t
simz1_snp %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
simz1_snp %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz1_snp %<>% bind_cols(parnames)
simz1_snp %<>% gather(key, value, -PC, -pct, -hr_y)
simz1_snp$PC <- factor(simz1_snp$PC, levels=c('1','6','11'))
simz1_snp$pct <- factor(simz1_snp$pct, levels=c('1','0.1','0.01','0.001'))
simz1_snp$hr_y <- factor(simz1_snp$hr_y, levels=c('0.8','0.5','0.2'))
save(simz1_snp, file = "result_snpz1.RData")
########################
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpsnpz2_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz2_snp <- tmp %>% t
simz2_snp %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
simz2_snp %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz2_snp %<>% bind_cols(parnames)
simz2_snp %<>% gather(key, value, -PC, -pct, -hr_y)
simz2_snp$PC <- factor(simz2_snp$PC, levels=c('1','6','11'))
simz2_snp$pct <- factor(simz2_snp$pct, levels=c('1','0.1','0.01','0.001'))
simz2_snp$hr_y <- factor(simz2_snp$hr_y, levels=c('0.8','0.5','0.2'))
save(simz2_snp, file = "result_snpz2.RData")
knitr::opts_chunk$set(echo = TRUE, fig.width = 16, fig.height = 12)
library(ggplot2)
library(tidyverse)
library(gridExtra)
library(tidyr)
library(scales)
library(magrittr)
library(latex2exp)
load('result_z1.RData')
load('result_z2.RData')
load('result_snpz1.RData')
load('result_snpz2.RData')
# levels(esti$noi) <- c("low", "high")
# data_summary <- function(x){
#   m <- mean(x)
#   sd <-sd(x)
#   ymin<-m-1.96*sd
#   ymax<-m+1.96*sd
#   return(c(y=m,ymin=ymin,ymax=ymax))
# }
# New facet label names
PC.labs <- c("PC1-5", "PC6-10", "PC11-15")
names(PC.labs) <- c("1", "6","11")
# pct.labs <- c("0.1", "0.01", "0.001")
# names(pct.labs) <- c("0.1", "0.01", "0.001")
# plot function
tm_plot <- function(dat, title, ylim=c(NA,NA)){
ggplot(data = dat, aes(x = key, y = value, color = key))+
geom_boxplot(size =1.5)+
ggtitle(title)+
scale_y_continuous(limits=ylim)+
theme_bw()+
theme(axis.text=element_text(size=15),
title =element_text(size=15, face='bold'),
strip.text = element_text(size = 20),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
legend.text = element_text(size=15, face='bold'),
legend.position = "bottom") +
facet_grid(PC~pct, labeller = labeller(PC = PC.labs)
)
}
g_legend<-function(a.gplot){
tmp <- ggplot_gtable(ggplot_build(a.gplot))
leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
legend <- tmp$grobs[[leg]]
return(legend)}
# esti$key %<>% factor(levels = c("a","b","B","ww","wwo","cc","cco","w_25","X_beta_25","c_25","Y_beta_25","R2TT","R2UU","RMSE","RMSE_x","RMSE_y","RMSE_train","RMSE_x_train","RMSE_y_train","R2","R2_x","R2_y","z_fit","sig2E","sig2F","sig2G","SigH","SigT","SigTo","SigUo","seedID"))
#
# levels(esti$key) <- c("a","b","B","W","Wo","C","Co","w_25","X_25","c_25","Y_25","R2TT","R2UU","RMSE","RMSE_x","RMSE_y","RMSE_train","RMSE_x_train","RMSE_y_train","R2","R2_x","R2_y","z_fit","sig2E","sig2F","sig2G","SigH","SigT","SigTo","SigUo","seedID")
# ab$key %<>% factor(levels = c("a", "a_b", "b"))
# levels(topss$method) <- c("O2PLS", "SO2PLS", "GO2PLS")
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 of Z in test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_t', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 of Z in test")
mylegend<-g_legend(p1)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
library(tidyverse)
library(magrittr)
library(reshape2)
library(parallel)
#########################################################################################
#### params
###########################################################################################
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpz1_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz1 <- tmp %>% t
simz1 %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
# add diff
simz1 %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz1 %<>% bind_cols(parnames)
simz1 %<>% gather(key, value, -PC, -pct, -hr_y)
simz1$PC <- factor(simz1$PC, levels=c('1','6','11'))
simz1$pct <- factor(simz1$pct, levels=c('1','0.1','0.01','0.001'))
simz1$hr_y <- factor(simz1$hr_y, levels=c('0.8','0.5','0.2'))
save(simz1, file = "result_z1.RData")
###############
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpz2_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz2 <- tmp %>% t
simz2 %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
simz2 %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz2 %<>% bind_cols(parnames)
simz2 %<>% gather(key, value, -PC, -pct, -hr_y)
simz2$PC <- factor(simz2$PC, levels=c('1','6','11'))
simz2$pct <- factor(simz2$pct, levels=c('1','0.1','0.01','0.001'))
simz2$hr_y <- factor(simz2$hr_y, levels=c('0.8','0.5','0.2'))
save(simz2, file = "result_z2.RData")
###########################################################################################
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpsnpz1_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz1_snp <- tmp %>% t
simz1_snp %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
simz1_snp %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz1_snp %<>% bind_cols(parnames)
simz1_snp %<>% gather(key, value, -PC, -pct, -hr_y)
simz1_snp$PC <- factor(simz1_snp$PC, levels=c('1','6','11'))
simz1_snp$pct <- factor(simz1_snp$pct, levels=c('1','0.1','0.01','0.001'))
simz1_snp$hr_y <- factor(simz1_snp$hr_y, levels=c('0.8','0.5','0.2'))
save(simz1_snp, file = "result_snpz1.RData")
########################
fls <- list.files()
fls %<>% subset(startsWith(fls, "outpsnpz2_"))
tmp <- lapply(fls, function(e) {outp <- readRDS(e); outp %>% unlist}) %>% simplify2array
colnames(tmp) <- fls
simz2_snp <- tmp %>% t
simz2_snp %<>% as_tibble
# $N $p $q $nrc $alpha_x $alpha_y $alpha_z $alpha_tu $sh_indx_i
simz2_snp %<>% mutate(R2_o2_diff = R2_o2-R2_o2_t,
R2_o2snp_diff = R2_o2snp-R2_o2snp_t,
R2_p_diff = R2_p-R2_p_t,
R2_pex_diff = R2_pex-R2_pex_t,
R2_prs_diff = R2_prs-R2_prs_t,
R2_prsZ_diff = R2_prsZ-R2_prsZ_t)
parnames <- str_split(colnames(tmp), "_|.rds") %>% sapply(function(e) e[c(2,3,4)] %>% unlist) %>% t %>% as_tibble
names(parnames) <- c("PC", "pct","hr_y")
simz2_snp %<>% bind_cols(parnames)
simz2_snp %<>% gather(key, value, -PC, -pct, -hr_y)
simz2_snp$PC <- factor(simz2_snp$PC, levels=c('1','6','11'))
simz2_snp$pct <- factor(simz2_snp$pct, levels=c('1','0.1','0.01','0.001'))
simz2_snp$hr_y <- factor(simz2_snp$hr_y, levels=c('0.8','0.5','0.2'))
save(simz2_snp, file = "result_snpz2.RData")
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 of Z in test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_t', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 of Z in test")
mylegend<-g_legend(p1)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_t', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 of Z in test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_t', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 of Z in test")
mylegend<-g_legend(p1)
cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene.pdf", width = 11, height =11, onefile =F, fallback_resolution = 600)
gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
p2 + theme(legend.position="none"),
nrow=1),
mylegend,nrow=2, heights=c(10,1))
dev.off()
p1 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.5') %>% filter(grepl('_diff', key)), 'Y heritability 0.5', ylim=c(0,0.9)) + ylab("R2 difference in training and test") +
scale_color_discrete(name = "Method", labels = c('O2PLS','O2PLS_snp','PO2PLS', 'PO2PLS-2', 'Omics-PRS', 'PRS')) + guides(colour = guide_legend(nrow = 1))
# p2 <- tm_plot(simz1 %>% filter(grepl('R2', key)) %>% filter(!grepl('o2snp', key)) %>% filter(hr_y=='0.2') %>% filter(grepl('_diff', key)), 'Y heritability 0.2', ylim=c(0,0.9)) + ylab("R2 difference in training and test")
# mylegend<-g_legend(p1)
cairo_pdf(file = "/home/z/Dropbox/articles/Omics_PRS/R2_gene_diff.pdf", width = 9, height =9, onefile =F, fallback_resolution = 600)
p1
# gridExtra::grid.arrange(arrangeGrob(p1 + theme(legend.position="none"),
#                                     p2 + theme(legend.position="none"),
#                                     nrow=1),
#                         mylegend,nrow=2, heights=c(10,1))
dev.off()
